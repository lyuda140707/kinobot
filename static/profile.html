<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ú—ñ–π –∫–∞–±—ñ–Ω–µ—Ç ‚Äî KinoSite</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    .profile-wrap{max-width:860px;margin:24px auto;padding:16px}
    .card{background:#0e0f13;border:1px solid #222;border-radius:16px;padding:20px;margin-bottom:16px}
    .muted{color:#9aa0a6;font-size:13px}
    .btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer}
    .btn-primary{background:#00ffd5;color:#000;font-weight:600}
    .btn-ghost{background:transparent;border:1px solid #444;color:#ddd}
    .input{width:100%;padding:10px 12px;border:1px solid #333;border-radius:10px;background:#111;color:#eee}
  </style>
</head>
<body>

<!-- –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Ç–≤—ñ–π —Å–ø—ñ–ª—å–Ω–∏–π —Ö–µ–¥–µ—Ä -->
<div id="header-placeholder"></div>
<script>
  fetch("header.html").then(r=>r.text()).then(html=>{
    document.getElementById("header-placeholder").innerHTML = html;
  }).catch(console.error);
</script>

<main class="profile-wrap">
  <h1>–ú—ñ–π –∫–∞–±—ñ–Ω–µ—Ç</h1>

  <!-- –∫–∞—Ä—Ç–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–ø–æ–∫–∏ —Å—Ö–æ–≤–∞–Ω–∞) -->
  <div class="card" id="user-card" style="display:none;">
    <h3 id="hello-line">–í—ñ—Ç–∞—é!</h3>
    <p class="muted">–°—Ç–∞—Ç—É—Å: <span id="pro-status">‚Äî</span></p>
    <button class="btn btn-ghost" id="logout-btn">–í–∏–π—Ç–∏</button>
  </div>

<div class="card" id="auth-card">
  <h3>–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Email</h3>
  <div style="display:flex;flex-direction:column;gap:8px;max-width:320px;">
    <input id="email-input" class="input" type="email" placeholder="email@example.com" />
    <button class="btn btn-primary" id="email-login-btn">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –≤—Ö–æ–¥—É</button>
  </div>
</div>
<!-- === –í—Ö—ñ–¥ —á–µ—Ä–µ–∑ Telegram === -->
<div class="card">
  <h3>–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram</h3>
  <p class="muted">
    –Ø–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ –Ω–∞—à Telegram-–±–æ—Ç, —Ü–µ–π —Å–ø–æ—Å—ñ–± –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –≤–∞—à PRO-—Å—Ç–∞—Ç—É—Å.
  </p>

  <!-- Telegram Login Widget -->
  <script async src="https://telegram.org/js/telegram-widget.js?22"
        data-telegram-login="RelaxBox_UA_bot"
        data-size="large"
        data-userpic="false"
        data-request-access="write"
        data-radius="8"
        data-auth-url="https://relaxbox.site/profile.html"
        data-onauth="onTelegramAuth">
</script>

</div>



<footer style="text-align:center;color:#8a8f98;margin:32px 0">¬© 2025 KinoSite</footer>
<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // ‚öôÔ∏è –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ —Ç–≤—ñ–π –ø—Ä–æ—î–∫—Ç Supabase
  const supabaseUrl = "https://zerlqvbmqszomlondlte.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InplcmxxdmJtcXN6b21sb25kbHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzg3NzQsImV4cCI6MjA3MDkxNDc3NH0.8wUBYIeQRC6KVp6vdzv0oqofIf4PeZyzbV5GcD0vxTE";
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
</script>
<script>
// ===== –í—Ö—ñ–¥ —á–µ—Ä–µ–∑ Email (magic link) =====
document.getElementById("email-login-btn").onclick = async () => {
  const email = document.getElementById("email-input").value.trim();
  if (!email) return alert("–í–≤–µ–¥—ñ—Ç—å email");
  const { error } = await supabase.auth.signInWithOtp({ email });
  alert(error ? "–ü–æ–º–∏–ª–∫–∞: " + error.message : "–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ—à—Ç—É, —â–æ–± —É–≤—ñ–π—Ç–∏!");
};


// ===== –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–∂–µ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π =====
supabase.auth.getUser().then(({ data }) => {
  if (data?.user) onUserLoggedIn(data.user);
});

// ===== –í–∏—Ö—ñ–¥ =====
document.getElementById("logout-btn").onclick = async () => {
  await supabase.auth.signOut();
  location.reload();
};

// ===== –ö–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–≤—ñ–π—à–æ–≤ =====
function onUserLoggedIn(user) {
  document.getElementById("auth-card").style.display = "none";
  document.getElementById("user-card").style.display = "block";
  document.getElementById("hello-line").innerText = "–í—ñ—Ç–∞—é, " + (user.email || user.phone);
  document.getElementById("pro-status").innerText = "Free ‚Äî —É–≤—ñ–π–¥–∏ —á–µ—Ä–µ–∑ Telegram, —â–æ–± —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ PRO.";
}
// === –í—Ö—ñ–¥ —á–µ—Ä–µ–∑ Telegram ===
async function onTelegramAuth(user) {
  console.log("Telegram user:", user);

  // 1Ô∏è‚É£ —Ö–æ–≤–∞—î–º–æ –±–ª–æ–∫ –≤—Ö–æ–¥—É
  document.getElementById("auth-card").style.display = "none";
  document.getElementById("user-card").style.display = "block";

  // 2Ô∏è‚É£ –ø–æ–∫–∞–∑—É—î–º–æ —ñ–º‚Äô—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
  document.getElementById("hello-line").innerText =
    `–í—ñ—Ç–∞—é, ${user.first_name || ""} ${user.last_name || ""}`.trim();

  // üß© –î–æ–ø–æ–º—ñ–∂–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
  function formatExpireDate(dateStr) {
    if (!dateStr) return "";
    // —è–∫—â–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å "2025-11-19T22:00:00.000Z"
    return dateStr.split("T")[0].split("-").reverse().join(".");
  }

  // 3Ô∏è‚É£ –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ PRO —É Google –¢–∞–±–ª–∏—Ü—ñ
  try {
    const res = await fetch("https://script.google.com/macros/s/AKfycbyrCxL8N7w1XC3JDU-A1QMlZn8NKs5QKaS1vg-TRjijk_zI00i_y5KP-N5_VNjUA17xyA/exec?user_id=" + encodeURIComponent(user.id));
    const json = await res.json();

    if (json.isPro) {
      const date = formatExpireDate(json.expireDate);
      document.getElementById("pro-status").innerHTML = `‚úÖ PRO –∞–∫—Ç–∏–≤–Ω–∏–π –¥–æ <b>${date}</b>`;
    } else {
      document.getElementById("pro-status").innerText = "‚ùå –ë–µ–∑ PRO";
    }
  } catch (e) {
    console.error(e);
    document.getElementById("pro-status").innerText = "‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ PRO";
  }
}

</script>

</body>
</html>
